<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Atividade Avaliativa - Química</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            /* Degradê de azul escuro para verde limão */
            background: linear-gradient(135deg, #0d47a1, #aeea00);
            color: #333;
        }
        .form-container {
            background-color: rgba(255, 255, 255, 0.9); /* Fundo branco semi-transparente */
            margin: 20px auto;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 1200px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            position: relative;
        }
        /* Cabeçalho da Escola */
        .header {
            margin-bottom: 20px;
            text-align: center;
        }
        .header h1 {
            font-size: 28px;
            margin: 0;
            color: #0d47a1; /* Azul escuro */
        }
        /* Conteúdo do Formulário */
        .form-content {
            margin-top: 20px;
        }
        .cabecalho {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        .cabecalho div, .serie-dropdown {
            width: 30%;
            min-width: 200px;
            margin-bottom: 10px;
        }
        .serie-dropdown {
            width: 25%;
            min-width: 150px;
            margin-bottom: 10px;
        }
        /* Campo de Nome */
        .nome-input input[type="text"] {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            border-radius: 5px;
            border: 2px solid #0d47a1;
            font-size: 16px;
            font-weight: bold;
            color: #0d47a1;
        }
        /* Campo de Seleção e Data */
        input[type="date"], select {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            border-radius: 5px;
            border: 2px solid #0d47a1;
            font-size: 16px;
            font-weight: bold;
            color: #0d47a1;
            background-color: white;
        }
        /* Título da Atividade */
        .atividade-titulo {
            text-align: center;
            margin-bottom: 10px;
        }
        .atividade-titulo h2 {
            font-size: 24px;
            color: #0d47a1;
            margin: 0;
        }
        .atividade-titulo p {
            font-size: 18px;
            color: #0d47a1;
            margin: 5px 0 20px 0;
        }
        /* Estilo para Numeração das Questões */
        .numero-questao {
            color: #d32f2f; /* Vermelho */
            font-weight: bold;
            margin-right: 10px;
        }
        /* Cronômetro */
        .relogio {
            font-size: 14px;
            text-align: center;
            border: 1px solid #cccccc;
            border-radius: 5px;
            padding: 5px 10px;
            background-color: #ffffff;
            color: #000000;
            margin-right: 10px;
            display: inline-block;
            min-width: 60px;
        }
        /* Valor da Questão */
        .valor-questao {
            background-color: #388e3c; /* Verde */
            color: #ffffff;
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
            font-size: 14px;
            display: inline-block;
            min-width: 60px;
            text-align: center;
            margin-bottom: 10px;
        }
        /* Questão */
        .questao {
            margin-bottom: 30px;
            background-color: #d3d3d3; /* Cinza Claro */
            padding: 20px;
            border-radius: 8px;
            position: relative;
        }
        .questao p {
            margin-bottom: 15px;
            font-size: 16px;
            color: #333333; /* Texto escuro */
        }
        /* Campo de Resposta */
        .resposta {
            width: 100%;
            height: 100px;
            padding: 10px;
            border-radius: 5px;
            border: 2px solid #0d47a1;
            resize: vertical;
            line-height: 1.5;
            background-color: #ffffff;
            background-image: repeating-linear-gradient(
                to bottom,
                #ffffff 0px,
                #ffffff 29px,
                #e0e0e0 29px,
                #e0e0e0 30px
            );
            background-size: 100% 30px;
            color: #0d47a1;
            font-size: 14px;
            font-weight: bold;
        }
        /* Botão de Envio com Efeito de Afundamento */
        button {
            display: block;
            margin: 30px auto;
            padding: 15px 30px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            background-color: #0d47a1;
            color: white;
            cursor: pointer;
            transition: transform 0.1s, background-color 0.3s;
        }
        button:active {
            transform: translateY(4px);
            background-color: #0b3d91;
        }
        /* Estilo para as linhas entre questões */
        .linha-questao {
            border-top: 2px solid #ffffff;
            margin: 30px 0;
        }
        /* Feedback */
        .feedback-container {
            background-color: #ffffff;
            color: #333333;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            display: none; /* Inicialmente escondido */
        }
        .feedback-container h3 {
            margin-top: 0;
            color: #0d47a1;
        }
        .feedback-questao {
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 5px;
        }
        .feedback-questao.correct {
            background-color: #d1e7dd; /* Azul Claro */
            color: #0f5132;
        }
        .feedback-questao.incorrect {
            background-color: #f8d7da; /* Vermelho Claro */
            color: #842029;
        }
        /* Responsividade */
        @media (max-width: 768px) {
            .form-container {
                width: 95%;
            }
            .cabecalho {
                flex-direction: column;
            }
            .cabecalho div, .serie-dropdown {
                width: 100%;
            }
            .questao {
                padding: 15px;
            }
            .linha-questao {
                margin: 20px 0;
            }
        }
    </style>
</head>
<body>

    <div class="form-container">
        <!-- Cabeçalho da Escola -->
        <div class="header">
            <h1>MARIA LEONI</h1>
        </div>

        <!-- Conteúdo do Formulário -->
        <div class="form-content">
            <div class="cabecalho">
                <div class="nome-input">
                    <p>NOME COMPLETO:
                        <input type="text" id="nome" name="nome" placeholder="Digite seu nome completo" required>
                    </p>
                </div>
                <div class="serie-dropdown">
                    <p>SÉRIE: 
                        <select id="serie" name="serie" required>
                            <option value="" disabled selected>Selecione a série</option>
                            <option value="1ªSérie A">1ªSérie A</option>
                            <option value="1ªSérie B">1ªSérie B</option>
                            <option value="1ªSérie C">1ªSérie C</option>
                        </select>
                    </p>
                </div>
                <div class="serie-dropdown">
                    <p>DATA: <input type="date" id="data" name="data" required></p>
                </div>
            </div>

            <!-- Título e Temas da Atividade -->
            <div class="atividade-titulo">
                <h2>ATIVIDADE DE QUÍMICA (4° BIMESTRE)</h2>
                <p>TEMAS: DISTRIBUIÇÃO ELETRÔNICA, LIGAÇÕES QUÍMICAS IÔNICA E COVALENTE.</p>
            </div>

            <!-- Container para as Questões -->
            <div id="questoes-container"></div>

            <!-- Botão de Envio -->
            <button onclick="enviarRespostas()">Enviar Respostas</button>
            
            <!-- Container para exibir o feedback -->
            <div id="feedback-container" class="feedback-container">
                <h3>Feedback da Autocorreção</h3>
                <div id="feedback-content"></div>
            </div>
        </div>

       <script>
    // URL do seu Web App do Google Apps Script
    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbyJJhktLKjmImpNlaJUCD-masl6sEU1yNX4m8KbM2Vz1GNHx3gbO1D8iPycxwMt6nU/exec'; // Substitua 'SUA_URL_DO_WEB_APP' pela URL correta

    // Array contendo as questões da atividade
    const questoes = [
        // Suas 10 questões aqui, conforme já definidas no HTML
        // ...
    ];

    // Objeto para armazenar os timers de cada questão
    const timers = {};

    // Função para iniciar o cronômetro de uma questão
    function iniciarCronometro(questaoId) {
        if (!timers[questaoId]) {
            timers[questaoId] = { segundos: 0, intervalo: null };
            timers[questaoId].intervalo = setInterval(() => {
                timers[questaoId].segundos += 1;
                atualizarCronometro(questaoId);
            }, 1000);
        }
    }

    // Função para parar o cronômetro de uma questão
    function pararCronometro(questaoId) {
        if (timers[questaoId] && timers[questaoId].intervalo) {
            clearInterval(timers[questaoId].intervalo);
            timers[questaoId].intervalo = null;
        }
    }

    // Função para formatar o tempo em mm:ss
    function formatarTempo(segundos) {
        const minutos = Math.floor(segundos / 60).toString().padStart(2, '0');
        const segundosRestantes = (segundos % 60).toString().padStart(2, '0');
        return `${minutos}:${segundosRestantes}`;
    }

    // Função para atualizar o display do cronômetro
    function atualizarCronometro(questaoId) {
        const relogioElement = document.getElementById(`relogio-${questaoId}`);
        if (relogioElement) {
            relogioElement.textContent = formatarTempo(timers[questaoId].segundos);
        }
    }

    // Função para enviar as respostas para o backend
    async function enviarRespostas() {
        console.log("Iniciando envio das respostas...");
        const nome = document.getElementById('nome').value.trim();
        const serie = document.getElementById('serie').value.trim();
        const data = document.getElementById('data').value.trim();

        // Validação dos campos obrigatórios
        if (!nome || !serie || !data) {
            alert("Por favor, preencha todos os campos antes de enviar.");
            console.log("Validação falhou: campos obrigatórios não preenchidos.");
            return;
        }

        // Coleta das respostas e tempos
        let respostas = {
            'nome': nome,
            'serie': serie,
            'data': data
        };

        const totalQuestoes = 10; // Número total de questões
        for (let i = 1; i <= totalQuestoes; i++) {
            const resposta = document.getElementById(`resposta-${i}`).value.trim();
            const tempo = document.getElementById(`tempo-${i}`).value.trim();

            respostas[`resposta-${i}`] = resposta;
            respostas[`tempo-${i}`] = tempo;
            pararCronometro(i); // Parar o cronômetro após enviar
            console.log(`Questão ${i}: Resposta = ${resposta}, Tempo = ${tempo} segundos`);
        }

        console.log("Enviando dados para o Web App:", respostas);

        try {
            const response = await fetch(WEB_APP_URL, { // URL do seu Web App
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams(respostas)
            });

            console.log("Resposta do servidor recebida:", response);

            // Verificar se a resposta é válida
            const result = await response.json();
            console.log("Dados de resposta JSON:", result);

            if (result.result === 'success') {
                console.log("Envio bem-sucedido:", result);
                // Limpar o formulário
                limparFormulario(totalQuestoes);

                // Exibir pontuação e feedback
                exibirFeedback(result.pontuacao, result.total, result.feedback, totalQuestoes);
            } else {
                // Exibir mensagem de erro no feedback-container
                console.error("Erro na resposta do servidor:", result.error);
                exibirErro("Erro ao enviar as respostas. Por favor, tente novamente.");
            }
        } catch (error) {
            console.error('Erro ao enviar respostas:', error);
            exibirErro("Erro ao enviar as respostas. Por favor, tente novamente.");
        }
    }

    // Função para limpar o formulário após envio
    function limparFormulario(totalQuestoes) {
        document.getElementById('nome').value = "";
        document.getElementById('serie').value = "";
        document.getElementById('data').value = "";
        for (let i = 1; i <= totalQuestoes; i++) {
            document.getElementById(`resposta-${i}`).value = "";
            document.getElementById(`tempo-${i}`).value = "";
            document.getElementById(`relogio-${i}`).innerText = "00:00";
        }
    }

    // Função para exibir feedback detalhado
    function exibirFeedback(pontuacao, total, feedback, totalQuestoes) {
        let feedbackHTML = `<p><strong>Atividade enviada com sucesso!</strong></p>`;
        feedbackHTML += `<p><strong>Pontuação Total:</strong> ${pontuacao} / ${total}</p><hr>`;
        feedbackHTML += `<h4>Feedback Detalhado:</h4>`;

        for (let i = 1; i <= totalQuestoes; i++) {
            const tipo = questoes[i - 1].tipo;
            const pontuacaoQuestao = parseFloat(feedback[i].pontuacao);
            const status = pontuacaoQuestao === 1 ? 'Correta' : (pontuacaoQuestao === 0 ? 'Incorreta' : 'Parcialmente Correta');
            const detalhes = feedback[i].feedback;
            const tempo = feedback[i].tempo;
            feedbackHTML += `
                <div class="feedback-questao ${pontuacaoQuestao === 1 ? 'correct' : (pontuacaoQuestao === 0 ? 'incorrect' : 'partial')}">
                    <p><strong>Questão ${i} (${tipo === 'aberta' ? 'Aberta' : 'Múltipla Escolha'}):</strong> ${status}</p>
                    <p>${detalhes}</p>
                    <p><strong>Tempo gasto:</strong> ${formatarTempo(tempo)}</p>
                </div>
            `;
        }

        // Exibir o feedback na página
        const feedbackContainer = document.getElementById('feedback-container');
        const feedbackContent = document.getElementById('feedback-content');
        feedbackContent.innerHTML = feedbackHTML;
        feedbackContainer.style.display = 'block';

        // Scroll para o feedback
        feedbackContainer.scrollIntoView({ behavior: 'smooth' });
    }

    // Função para exibir mensagem de erro
    function exibirErro(mensagem) {
        const feedbackContainer = document.getElementById('feedback-container');
        const feedbackContent = document.getElementById('feedback-content');
        feedbackContent.innerHTML = `<p style="color: red;"><strong>${mensagem}</strong></p>`;
        feedbackContainer.style.display = 'block';
        feedbackContainer.scrollIntoView({ behavior: 'smooth' });
    }

    // Função para gerar as questões dinamicamente na página
    function gerarQuestoes() {
        const container = document.getElementById('questoes-container');
        questoes.forEach((questao, index) => {
            const questaoId = index + 1;

            const questaoDiv = document.createElement('div');
            questaoDiv.classList.add('questao');

            // Cronômetro
            const relogioDiv = document.createElement('div');
            relogioDiv.classList.add('relogio');
            relogioDiv.id = `relogio-${questaoId}`;
            relogioDiv.textContent = "00:00";
            questaoDiv.appendChild(relogioDiv);

            // Valor da Questão
            const valorDiv = document.createElement('div');
            valorDiv.classList.add('valor-questao');
            valorDiv.textContent = "0,3 pts";
            questaoDiv.appendChild(valorDiv);

            // Detalhes da Questão (Aula e Tema, Tema, Habilidade)
            const detalhesDiv = document.createElement('div');
            detalhesDiv.classList.add('detalhes-questao');
            detalhesDiv.innerHTML = `
                <p><strong>Aula e Tema:</strong> ${questao.numeroAula}</p>
                <p><strong>Tema:</strong> ${questao.tema}</p>
                <p><strong>Habilidade:</strong> ${questao.habilidade}</p>
            `;
            questaoDiv.appendChild(detalhesDiv);

            // Pergunta com Numeração e Nível
            const pergunta = document.createElement('p');

            // Criar elemento para número da questão
            const numeroSpan = document.createElement('span');
            numeroSpan.classList.add('numero-questao');
            numeroSpan.textContent = `${questaoId}. `;

            // Adicionar número, nível e texto da questão
            pergunta.appendChild(numeroSpan);
            pergunta.appendChild(document.createTextNode(`${questao.nivel}\n\n${questao.texto}`));
            questaoDiv.appendChild(pergunta);

            // Campo de Resposta
            if (questao.tipo === 'aberta') {
                const resposta = document.createElement('textarea');
                resposta.id = `resposta-${questaoId}`;
                resposta.name = `resposta-${questaoId}`;
                resposta.placeholder = "Digite sua resposta aqui...";
                resposta.classList.add('resposta');
                resposta.required = true;

                // Iniciar o cronômetro ao focar na textarea
                resposta.addEventListener('focus', () => iniciarCronometro(questaoId));
                resposta.addEventListener('blur', () => pararCronometro(questaoId));
                questaoDiv.appendChild(resposta);
            }

            // Campo de Tempo
            const tempoLabel = document.createElement('label');
            tempoLabel.setAttribute('for', `tempo-${questaoId}`);
            tempoLabel.textContent = "Tempo (s):";
            questaoDiv.appendChild(tempoLabel);
            questaoDiv.appendChild(document.createElement('br'));

            const tempoInput = document.createElement('input');
            tempoInput.type = 'number';
            tempoInput.id = `tempo-${questaoId}`;
            tempoInput.name = `tempo-${questaoId}`;
            tempoInput.min = '0';
            tempoInput.required = true;
            questaoDiv.appendChild(tempoInput);
            questaoDiv.appendChild(document.createElement('br'));
            questaoDiv.appendChild(document.createElement('br'));

            // Adicionar linha separadora entre questões, exceto após a última
            if (questaoId < questoes.length) {
                const linha = document.createElement('hr');
                linha.classList.add('linha-questao');
                questaoDiv.appendChild(linha);
            }

            container.appendChild(questaoDiv);
        });
    }

    // Inicializa as questões ao carregar a página
    window.onload = gerarQuestoes;
</script>
